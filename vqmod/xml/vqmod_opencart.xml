<?xml version="1.0" encoding="UTF-8"?>
<modification>
  <id>VQMOD CORE FOR OPENCART - DO NOT REMOVE</id>
  <version>1.4.x and above</version>
  <vqmver required="true">2.6.0</vqmver>
  <author>vqmod.com</author>

  <file name="system/startup.php,system/engine/*.php,system/library/*.php,admin/controller/extension/*.php,system/library/template/*.php,catalog/controller/event/theme.php,system/library/template/Twig/*.php" error="skip">
    <operation error="skip" info="For non OCMod includes/requires">
      <search position="replace" regex="true"><![CDATA[~^(\s*)(require|include)(_once)?(\s+|\()(?!VQMod::modCheck\()(?!modification\()([^);]+)~]]></search>
      <add><![CDATA[$1$2$3$4\\VQMod::modCheck($5)]]></add>
    </operation>
    <operation error="skip" info="For OCMod includes/requires - OPERATION MUST BE AFTER NON OCMOD INCLUDES/REQUIRES OPERATION">
      <search position="replace" regex="true"><![CDATA[~(require|include)(_once)?\((?!VQMod::modCheck\()modification\(([^)]+)~]]></search>
      <add><![CDATA[$1$2(\\VQMod::modCheck(modification($3), $3]]></add>
    </operation>
  </file>

  <file name="system/library/template/Twig/*.php" error="skip">
    <operation error="skip" info="Add Twig support">
      <search position="replace"><![CDATA[dirname(__FILE__).'/../']]></search>
      <add><![CDATA[DIR_SYSTEM . 'library/template/']]></add>
    </operation>
  </file>

  <file name="system/library/template/Twig/Loader/*.php" error="skip">
    <operation error="skip" info="Add Twig support">
      <search position="replace"><![CDATA[= $realpath;]]></search>
      <add><![CDATA[= VQMod::modCheck($realpath, DIR_TEMPLATE . $name);]]></add>
    </operation>
  </file>

  <!--自定义一些内容-->
  <file name="catalog/language/zh-cn/extension/shipping/item.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">按件运费</search>
      <add>按件运费(一件代发)</add>
    </operation>
  </file>
  <file name="catalog/language/zh-cn/extension/shipping/free.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">免费配送</search>
      <add>免费配送(全部发货)</add>
    </operation>
  </file>
  <file name="catalog/language/en-gb/extension/shipping/item.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">Per Item</search>
      <add>Per Item(Instead of shipping)</add>
    </operation>
    <operation error="skip" info="change the translations">
      <search position="replace">Per Item Shipping Rate</search>
      <add>Per Item Shipping Rate(Instead of shipping)</add>
    </operation>
  </file>
  <file name="catalog/language/en-gb/extension/shipping/free.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">Free Shipping</search>
      <add>Free Shipping(All shipments)</add>
    </operation>
  </file>

  <file name="admin/language/en-gb/extension/shipping/free.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">Free Shipping</search>
      <add>Free Shipping(All shipments)</add>
    </operation>
  </file>
  <file name="admin/language/en-gb/extension/shipping/item.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">Per Item</search>
      <add>Per Item(Instead of shipping)</add>
    </operation>
  </file>
  <file name="admin/language/zh-cn/extension/shipping/free.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">Free Shipping</search>
      <add>Free Shipping(All shipments)</add>
    </operation>
  </file>
  <file name="admin/language/zh-cn/extension/shipping/free.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">免费配送</search>
      <add>免费配送(全部发货)</add>
    </operation>
  </file>
  <file name="admin/language/zh-cn/extension/shipping/item.php" error="skip">
    <operation error="skip" info="change the translations">
      <search position="replace">按件计费</search>
      <add>按件计费(一件代发)</add>
    </operation>
  </file>
  <file name="catalog/controller/startup/session.php" error="skip">
    <operation error="skip" info="change session logic">
      <search position="after">
        <![CDATA[$this->db->query("DELETE FROM `" . DB_PREFIX . "api_session` WHERE TIMESTAMPADD(HOUR, 1, date_modified) < NOW()");]]>
      </search>
      <add>
        <![CDATA[if (!isset($this->request->get['api_token'])) return;]]>
      </add>
    </operation>
  </file>
</modification>